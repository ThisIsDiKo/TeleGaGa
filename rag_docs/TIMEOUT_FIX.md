# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ –∏ —É–ø—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

## –ü—Ä–æ–±–ª–µ–º—ã

1. **Socket timeout** - qwen3:4b –º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –±–æ–ª—å—à–∏–µ RAG –ø—Ä–æ–º–ø—Ç—ã (60 —Å–µ–∫—É–Ω–¥ –±—ã–ª–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
2. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã** - Unicode —Å–∏–º–≤–æ–ª—ã (‚îÅ, üî¥, ‚úÖ, ‚ùå) —É–≤–µ–ª–∏—á–∏–≤–∞–ª–∏ —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞

## –†–µ—à–µ–Ω–∏—è

### 1. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (Main.kt:86-117)

**–î–æ (900+ —Å–∏–º–≤–æ–ª–æ–≤ —Å Unicode):**
```kotlin
val RagWithCitationsRole = """
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ê–ë–°–û–õ–Æ–¢–ù–´–ï –ü–†–ê–í–ò–õ–ê (–ù–ê–†–£–®–ï–ù–ò–ï –ó–ê–ü–†–ï–©–ï–ù–û):
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
...
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
"""
```

**–ü–æ—Å–ª–µ (400 —Å–∏–º–≤–æ–ª–æ–≤, —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç):**
```kotlin
val RagWithCitationsRole = """
–¢—ã AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê:

1. –ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û –ü–†–ï–î–û–°–¢–ê–í–õ–ï–ù–ù–´–ï –§–†–ê–ì–ú–ï–ù–¢–´
2. –ö–ê–ñ–î–´–ô –§–ê–ö–¢ –î–û–õ–ñ–ï–ù –ò–ú–ï–¢–¨ –¶–ò–¢–ê–¢–£
3. –ó–ê–ü–†–ï–©–ï–ù–û:
   - –û—Ç–≤–µ—á–∞—Ç—å –±–µ–∑ —Ü–∏—Ç–∞—Ç
   - –ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Ñ–∞–∫—Ç—ã
   - –ü–∏—Å–∞—Ç—å "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", –µ—Å–ª–∏ –æ–Ω–∞ –ï–°–¢–¨ –≤ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö
...
"""
```

**–≠–∫–æ–Ω–æ–º–∏—è:** ~500 —Å–∏–º–≤–æ–ª–æ–≤ (~125 —Ç–æ–∫–µ–Ω–æ–≤)

### 2. –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (RagService.kt:167-202)

**–î–æ:**
```kotlin
appendLine("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
appendLine("–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –î–õ–Ø –û–¢–í–ï–¢–ê –ù–ê –í–û–ü–†–û–°")
appendLine("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
appendLine("üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:")
appendLine("üìç –õ–æ–∫–∞—Ü–∏—è: ...")
appendLine("üéØ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ...")
appendLine("üìé –ò—Å–ø–æ–ª—å–∑—É–π —Ü–∏—Ç–∞—Ç—É: ...")
appendLine("üìÑ –°–û–î–ï–†–ñ–ê–ù–ò–ï:")
```

**–ü–æ—Å–ª–µ:**
```kotlin
appendLine("=== –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –î–õ–Ø –û–¢–í–ï–¢–ê ===")
appendLine("–í–ê–ñ–ù–û:")
appendLine("- –≠—Ç–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –≤–æ–ø—Ä–æ—Å—É")
appendLine("--- –§—Ä–∞–≥–º–µ–Ω—Ç 1 ---")
appendLine("–ò—Å—Ç–æ—á–Ω–∏–∫: ...")
appendLine("–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ...")
appendLine("–¶–∏—Ç–∞—Ç–∞: ...")
```

**–≠–∫–æ–Ω–æ–º–∏—è:** ~300 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (~75 —Ç–æ–∫–µ–Ω–æ–≤)

### 3. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤ HTTP (Main.kt:252-257)

**–î–æ:**
```kotlin
install(HttpTimeout) {
    requestTimeoutMillis = 60000   // 60 —Å–µ–∫—É–Ω–¥
    socketTimeoutMillis = 60000    // 60 —Å–µ–∫—É–Ω–¥
}
```

**–ü–æ—Å–ª–µ:**
```kotlin
install(HttpTimeout) {
    requestTimeoutMillis = 180000  // 3 –º–∏–Ω—É—Ç—ã
    socketTimeoutMillis = 180000   // 3 –º–∏–Ω—É—Ç—ã
}
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- qwen3:4b –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ~5-10 —Ç–æ–∫–µ–Ω–æ–≤/—Å–µ–∫ –Ω–∞ —Å—Ä–µ–¥–Ω–µ–º –∂–µ–ª–µ–∑–µ
- RAG –ø—Ä–æ–º–ø—Ç —Å 5 —á–∞–Ω–∫–∞–º–∏ = ~1500-2000 —Ç–æ–∫–µ–Ω–æ–≤
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 150-200 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- 180 —Å–µ–∫—É–Ω–¥ (3 –º–∏–Ω—É—Ç—ã) - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ª–∏–º–∏—Ç

## –ò—Ç–æ–≥–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞:** ~800 —Å–∏–º–≤–æ–ª–æ–≤ (~200 —Ç–æ–∫–µ–Ω–æ–≤)
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:** ~20-30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** —Ç–∞–π–º–∞—É—Ç —É–≤–µ–ª–∏—á–µ–Ω –≤ 3 —Ä–∞–∑–∞

### –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —ç–º–æ–¥–∑–∏ –∏ Unicode
- –ë–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
```bash
export JAVA_HOME=/Users/dmitriikonovalov/Library/Java/JavaVirtualMachines/openjdk-17.0.1/Contents/Home
./gradlew run
```

### 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ embeddings
```bash
# –í Telegram –±–æ—Ç–µ
/createEmbeddings
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É
```bash
/testRagCitations –∫–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏?
```

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- ‚úÖ –ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (–±–µ–∑ —Ç–∞–π–º–∞—É—Ç–∞)
- ‚úÖ –ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
- ‚úÖ –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ [–∏—Å—Ç–æ—á–Ω–∏–∫: —Ñ–∞–π–ª, —Å—Ç—Ä–æ–∫–∏ X-Y]
- ‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 60-120 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å–∞)

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –µ—Å–ª–∏ –≤—Å—ë –µ—â—ë –º–µ–¥–ª–µ–Ω–Ω–æ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å
```bash
ollama pull qwen2.5:3b  # –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º qwen3:4b
# –∏–ª–∏
ollama pull mistral     # –•–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
```

–ò–∑–º–µ–Ω–∏—Ç–µ –≤ OllamaClient.kt:28:
```kotlin
model = "qwen2.5:3b"  // –∏–ª–∏ "mistral"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤
–í TelegramBotService.kt:649 –∏–∑–º–µ–Ω–∏—Ç–µ topK:
```kotlin
val searchResult = ragService.findRelevantChunksWithFilter(
    query, "readme", 3, threshold  // –±—ã–ª–æ 5, —Å—Ç–∞–ª–æ 3
)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–≤–µ–ª–∏—á—å—Ç–µ –ø–æ—Ä–æ–≥ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
```bash
/setThreshold 0.7  # –ú–µ–Ω—å—à–µ —á–∞–Ω–∫–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç
```

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `Main.kt` - —É–ø—Ä–æ—â—ë–Ω RagWithCitationsRole, —É–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã
2. `RagService.kt` - —É–ø—Ä–æ—â–µ–Ω–æ formatContextWithCitations()

## –†–∞–∑–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

- –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç: —Å ~900 –¥–æ ~400 —Å–∏–º–≤–æ–ª–æ–≤ (-55%)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: —Å ~500 –¥–æ ~300 —Å–∏–º–≤–æ–ª–æ–≤ (-40%)
- –¢–∞–π–º–∞—É—Ç—ã: —Å 60 –¥–æ 180 —Å–µ–∫—É–Ω–¥ (+200%)

–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!
